<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë©´ì ‘ ê²°ê³¼</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            max-width: 600px;
            width: 95%;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; }
        .header p { font-size: 1.2em; opacity: 0.9; }
        .content {
            padding: 40px;
            text-align: center;
        }
        .score-container {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
            border: 3px solid #e9ecef;
        }
        .score-title {
            font-size: 1.3em;
            color: #495057;
            margin-bottom: 15px;
            font-weight: bold;
        }
        .score-value {
            font-size: 4em;
            font-weight: bold;
            margin: 20px 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .score-description {
            font-size: 1.1em;
            color: #6c757d;
            line-height: 1.6;
            margin-bottom: 20px;
        }
        .score-interpretation {
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            font-weight: bold;
        }
        .excellent { background: #d4edda; color: #155724; }
        .good { background: #d1ecf1; color: #0c5460; }
        .average { background: #fff3cd; color: #856404; }
        .poor { background: #f8d7da; color: #721c24; }
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            font-size: 1.1em;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            margin: 10px;
        }
        .btn-primary {
            background: #667eea;
            color: white;
        }
        .btn-primary:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        .btn-secondary:hover {
            background: #545b62;
            transform: translateY(-2px);
        }
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 15px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: width 1s ease;
            border-radius: 10px;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>ğŸ“Š ë©´ì ‘ ê²°ê³¼</h1>
        <p>ì‹œì„  ì•ˆì •ì„± ë¶„ì„ ê²°ê³¼</p>
    </div>

    <div class="content">
        <div class="score-container">
            <div class="score-title">ì‹œì„  ì•ˆì •ì„± ì ìˆ˜</div>
            <div class="score-value">{{ jitter_score }}</div>
            <div class="score-description">
                ì‹œì„ ì˜ í”ë“¤ë¦¼ ì •ë„ë¥¼ ì¸¡ì •í•˜ì—¬ 0-100ì ìœ¼ë¡œ í‰ê°€í–ˆìŠµë‹ˆë‹¤.<br>
                ë†’ì€ ì ìˆ˜ì¼ìˆ˜ë¡ ì‹œì„ ì´ ì•ˆì •ì ì„ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.`
            </div>
            
            <div class="progress-bar">
                <div class="progress-fill" style="width: {{jitter_score}}%"></div>
            </div>
            
            {% if jitter_score >= 80 %}
                <div class="score-interpretation excellent">
                    ğŸŒŸ ìš°ìˆ˜í•¨: ë§¤ìš° ì•ˆì •ì ì¸ ì‹œì„ ì„ ìœ ì§€í–ˆìŠµë‹ˆë‹¤!
                </div>
            {% elif jitter_score >= 60 %}
                <div class="score-interpretation good">
                    ğŸ‘ ì–‘í˜¸í•¨: ë©´ì ‘ ì¤‘ ì‹œì„  ì²˜ë¦¬ê°€ ì–‘í˜¸í•©ë‹ˆë‹¤.
                </div>
            {% elif jitter_score >= 40 %}
                <div class="score-interpretation average">
                    âš ï¸ ë³´í†µ: ì‹œì„  ì•ˆì •ì„±ì„ ë” ê°œì„ í•˜ì„¸ìš”.
                </div>
            {% else %}
                <div class="score-interpretation poor">
                    ğŸ“ˆ ê°œì„  í•„ìš”: ì‹œì„  ì²˜ë¦¬ê°€ ë§ì´ ë¶ˆì•ˆí•©ë‹ˆë‹¤. ë” ë…¸ë ¥í•˜ì„¸ìš”.
                </div>
            {% endif %}
        </div>

        <!-- ì‹œì„  ë²”ìœ„ ì‹œê°í™” ì„¹ì…˜ -->
        <div style="margin-top: 30px;">
            <h3 style="color: #495057; margin-bottom: 15px;">ğŸ‘ï¸ ì‹œì„  ë²”ìœ„ ë¶„ì„</h3>
            <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                <p style="color: #6c757d; margin-bottom: 15px; text-align: center;">
                    íŒŒë€ìƒ‰ ì˜ì—­: í™˜ê²½ì„¤ì •ì—ì„œ ì¸¡ì •ëœ ì‹œì„  ê°€ëŠ¥ ë²”ìœ„<br>
                    ë¹¨ê°„ìƒ‰ ì : ë©´ì ‘ ì¤‘ ì‹¤ì œ ì‹œì„  ìœ„ì¹˜ (20ê°œ ìƒ˜í”Œ)
                </p>
                <canvas id="gazeVisualization" width="500" height="300" style="border: 2px solid #dee2e6; border-radius: 10px; background: white; display: block; margin: 0 auto;"></canvas>
            </div>
        </div>

        <div style="margin-top: 30px;">
            <h3 style="color: #495057; margin-bottom: 15px;">ğŸ’¡ ê°œì„  íŒ</h3>
            <div style="text-align: left; background: #f8f9fa; padding: 20px; border-radius: 10px;">
                <ul style="color: #6c757d; line-height: 1.8;">
                    <li>ë©´ì ‘ ì¤‘ í•œ ì ì„ ì§‘ì¤‘í•´ì„œ ë°”ë¼ë³´ì„¸ìš”</li>
                    <li>ê¸´ì¥í•˜ì§€ ë§ê³  ìì—°ìŠ¤ëŸ½ê²Œ ì‹œì„ ì„ ìœ ì§€í•˜ì„¸ìš”</li>
                    <li>ì¹´ë©”ë¼ ë Œì¦ˆë¥¼ ì§ì ‘ ë°”ë¼ë³´ëŠ” ì—°ìŠµì„ í•˜ì„¸ìš”</li>
                    <li>ê·œì¹™ì ì¸ ì‹œì„  ì§‘ì¤‘ í›ˆë ¨ì„ í•´ë³´ì„¸ìš”</li>
                </ul>
            </div>
        </div>

        <div style="margin-top: 30px;">
            <a href="/" class="btn btn-primary">ğŸ”„ ë‹¤ì‹œ ì¸¡ì •í•˜ê¸°</a>
            <button class="btn btn-secondary" onclick="window.close()">âœ… ì™„ë£Œ</button>
        </div>
    </div>
</div>

<!-- ë°ì´í„° ì „ë‹¬ì„ ìœ„í•œ ìˆ¨ê²¨ì§„ ìŠ¤í¬ë¦½íŠ¸ íƒœê·¸ -->
<script type="application/json" id="calibrationData">{{ calibration_points | tojson | safe }}</script>
<script type="application/json" id="interviewData">{{ interview_points | tojson | safe }}</script>

<script>
// í˜ì´ì§€ ë¡œë“œ ì‹œ ì ìˆ˜ ì• ë‹ˆë©”ì´ì…˜ ë° ì‹œì„  ì‹œê°í™”
document.addEventListener('DOMContentLoaded', function() {
    // ì ìˆ˜ ì• ë‹ˆë©”ì´ì…˜
    const scoreValue = document.querySelector('.score-value');
    const targetScore = {{ jitter_score }};
    let currentScore = 0;
    
    const animation = setInterval(() => {
        if (currentScore < targetScore) {
            currentScore += Math.ceil((targetScore - currentScore) / 10);
            scoreValue.textContent = currentScore;
        } else {
            scoreValue.textContent = targetScore;
            clearInterval(animation);
        }
    }, 50);
    
    // ì‹œì„  ë²”ìœ„ ì‹œê°í™”
    const canvas = document.getElementById('gazeVisualization');
    if (canvas) {
        const ctx = canvas.getContext('2d');
        
        // ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        let calibrationPoints = [];
        let interviewPoints = [];
        
        try {
            const calibrationData = document.getElementById('calibrationData');
            const interviewData = document.getElementById('interviewData');
            
            if (calibrationData && calibrationData.textContent) {
                calibrationPoints = JSON.parse(calibrationData.textContent);
            }
            if (interviewData && interviewData.textContent) {
                interviewPoints = JSON.parse(interviewData.textContent);
            }
        } catch (e) {
            console.log('ë°ì´í„° íŒŒì‹± ì˜¤ë¥˜:', e);
        }
        
        // Canvas í¬ê¸°
        const canvasWidth = canvas.width;
        const canvasHeight = canvas.height;

        // ë°ì´í„°ê°€ ìˆëŠ” ê²½ìš°ì—ë§Œ ì‹œê°í™”
        if (calibrationPoints && calibrationPoints.length >= 4) {
            // ì¢Œí‘œ ì •ê·œí™”ë¥¼ ìœ„í•œ ë²”ìœ„ ê³„ì‚° (ë©´ì ‘í¬ì¸íŠ¸ê¹Œì§€ í¬í•¨)
            const allX = calibrationPoints.map(p => p.x).concat(interviewPoints ? interviewPoints.map(p => p.x) : []);
            const allY = calibrationPoints.map(p => p.y).concat(interviewPoints ? interviewPoints.map(p => p.y) : []);
            // ì§ì‚¬ê°í˜• ë²”ìœ„ (calibration point 4ê°œë§Œ ì‚¬ìš©)
            const rectX = calibrationPoints.map(p => p.x);
            const rectY = calibrationPoints.map(p => p.y);

            const minX = Math.min(...rectX);
            const maxX = Math.max(...rectX);
            const minY = Math.min(...rectY);
            const maxY = Math.max(...rectY);

            // ì¢Œí‘œ ë³€í™˜ í•¨ìˆ˜ (ì‹¤ì œ ì¢Œí‘œ -> Canvas ì¢Œí‘œ)
            const allCanvasX = allX.concat([minX, maxX]);
            const allCanvasY = allY.concat([minY, maxY]);
            const normMinX = Math.min(...allCanvasX) - 20;
            const normMaxX = Math.max(...allCanvasX) + 20;
            const normMinY = Math.min(...allCanvasY) - 20;
            const normMaxY = Math.max(...allCanvasY) + 20;
            function transformX(x) {
                return ((x - normMinX) / (normMaxX - normMinX)) * (canvasWidth - 40) + 20;
            }

            const yOffset = canvasHeight * 0.25;

            function transformY(y) {
                return ((y - normMinY) / (normMaxY - normMinY)) * (canvasHeight - 40) + 20 + yOffset;
            }

            // ì§ì‚¬ê°í˜• ë„¤ ê¼­ì§“ì  ê³„ì‚°
            const rectPoints = [
                { x: minX, y: minY, label: 'ì¢Œìƒë‹¨' },  // ì¢Œìƒë‹¨
                { x: maxX, y: minY, label: 'ìš°ìƒë‹¨' },  // ìš°ìƒë‹¨
                { x: maxX, y: maxY, label: 'ìš°í•˜ë‹¨' },  // ìš°í•˜ë‹¨
                { x: minX, y: maxY, label: 'ì¢Œí•˜ë‹¨' }   // ì¢Œí•˜ë‹¨
            ];

            // ì§ì‚¬ê°í˜• ê·¸ë¦¬ê¸° (íŒŒë€ìƒ‰ ì˜ì—­)
            ctx.beginPath();
            ctx.moveTo(transformX(rectPoints[0].x), transformY(rectPoints[0].y));
            for (let i = 1; i < rectPoints.length; i++) {
                ctx.lineTo(transformX(rectPoints[i].x), transformY(rectPoints[i].y));
            }
            ctx.closePath();
            ctx.fillStyle = 'rgba(102, 126, 234, 0.3)';
            ctx.fill();
            ctx.strokeStyle = 'rgba(102, 126, 234, 0.8)';
            ctx.lineWidth = 2;
            ctx.stroke();

            // ê¼­ì§“ì ì— íŒŒë€ ì› ì°ê¸°
            rectPoints.forEach(point => {
                ctx.beginPath();
                ctx.arc(transformX(point.x), transformY(point.y), 6, 0, 2 * Math.PI);
                ctx.fillStyle = '#667eea';
                ctx.fill();
                ctx.strokeStyle = '#ffffff';
                ctx.lineWidth = 2;
                ctx.stroke();
            });

            // ë©´ì ‘ ì‹œì„  ì ë“¤ ê·¸ë¦¬ê¸° (ë¹¨ê°„ìƒ‰ ì )
            if (interviewPoints && interviewPoints.length > 0) {
                interviewPoints.forEach((point, index) => {
                    ctx.beginPath();
                    ctx.arc(transformX(point.x), transformY(point.y), 4, 0, 2 * Math.PI);
                    ctx.fillStyle = '#dc3545';
                    ctx.fill();
                    ctx.strokeStyle = '#ffffff';
                    ctx.lineWidth = 1;
                    ctx.stroke();
                });
            }

            // ë²”ë¡€ ì¶”ê°€
            ctx.fillStyle = '#495057';
            ctx.font = '14px Arial';
            ctx.textAlign = 'left';
            ctx.fillText('ğŸ“ í™˜ê²½ì„¤ì • 4í¬ì¸íŠ¸', 20, canvasHeight - 40);
            ctx.fillText('ğŸ”´ ë©´ì ‘ ì¤‘ ì‹œì„ ', 20, canvasHeight - 20);

        } else {
            // ë°ì´í„°ê°€ ì—†ëŠ” ê²½ìš° ì•ˆë‚´ ë©”ì‹œì§€
            ctx.fillStyle = '#6c757d';
            ctx.font = '16px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('í™˜ê²½ ì„¤ì • ë° ë©´ì ‘ ë°ì´í„°ê°€ í•„ìš”í•©ë‹ˆë‹¤.', canvasWidth/2, canvasHeight/2);
        }
    }
});
</script>
</body>
</html>
